<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Lab â€” Inventory Management</title>

  <!-- Google Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <!-- QR Code Generator Library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <meta name="theme-color" content="#0b2340">
  <style>
/* =========================
   THEME, RESET & UTILITIES
   ========================= */
:root{
  --bg-900:#071021; --bg-800:#0b2540; --surface: #0f2b48; --muted:#98a6b3; --text:#eaf3ff;
  --accent-blue:#4f8cff; --accent-purple:#8b5cf6; --accent-green:#34d399; --accent-red:#ff6b6b; --accent-yellow:#ffd166;
  --glass: rgba(255,255,255,0.03); --radius:12px; --container:1400px; --ease: cubic-bezier(.2,.9,.3,1);
}
html.light{
  --bg-900:#f7fbff; --bg-800:#eef6ff; --surface:#ffffff; --muted:#6b7280; --text:#0b2340; --glass: rgba(0,0,0,0.04);
}
*{box-sizing:border-box}
body{ margin:0; font-family:"Roboto",sans-serif; background:var(--bg-800); color:var(--text); line-height:1.45; }
.container{ max-width:var(--container); margin:0 auto; padding:0 20px; }
.kv{ color:var(--muted); font-size:13px; }
.hidden{ display:none!important; }
.fade-in{ opacity:0; transform:translateY(12px); transition: all 520ms var(--ease); }
.fade-in.show{ opacity:1; transform:none }

/* =========================
   LAYOUT & HEADER
   ========================= */
.header{ display:flex; align-items:center; justify-content:space-between; padding:14px 0; position:sticky; top:0; z-index:1200; backdrop-filter:blur(6px); background:linear-gradient(180deg,rgba(8,12,20,0.6),rgba(8,12,20,0.35)); border-bottom:1px solid var(--glass); }
html.light .header{ background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(255,255,255,0.9)); border-bottom:1px solid rgba(0,0,0,0.06); }
.brand{ display:flex; gap:12px; align-items:center; }
.logo{ width:52px; height:52px; border-radius:12px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--accent-blue),var(--accent-green)); color:#fff; font-weight:800; font-family:"Poppins"; }
.dashboard-wrap{ display:grid; grid-template-columns:260px 1fr; gap:20px; padding:20px 0; }
.sidebar{ position:sticky; top:84px; height:calc(100vh - 120px); padding:18px; border-radius:var(--radius); background:var(--surface); border:1px solid var(--glass); box-shadow:0 12px 36px rgba(0,0,0,0.12); display:flex; flex-direction:column; gap:12px; }
.content{ padding:0; }

/* =========================
   SHARED COMPONENTS
   ========================= */
.btn{ border:0; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
.btn-primary{ background:linear-gradient(90deg,var(--accent-blue),var(--accent-purple)); color:#fff; }
.btn-ghost{ background:transparent; border:1px solid var(--glass); color:var(--text); }
.card{ background:var(--surface); padding:18px; border-radius:var(--radius); border:1px solid var(--glass); box-shadow:0 12px 36px rgba(0,0,0,0.08); }
.tab-btn{ display:flex; gap:12px; align-items:center; padding:12px; border-radius:10px; font-weight:700; cursor:pointer; background:transparent; border:0; color:var(--text); width:100%; text-align:left; }
.tab-btn[aria-selected="true"]{ background:linear-gradient(90deg,var(--accent-blue),var(--accent-purple)); color:#fff; }
.data-table{ width:100%; border-collapse:collapse; margin-top:12px; }
.data-table th, .data-table td{ padding:12px; text-align:left; border-bottom:1px solid var(--glass); }
.data-table th{ font-size:13px; color:var(--muted); }
.status-badge{ padding:4px 8px; border-radius:8px; font-size:12px; font-weight:700; }
.status-available{ background:rgba(52,211,153,0.1); color:var(--accent-green); }
.status-in-use{ background:rgba(255,209,102,0.1); color:var(--accent-yellow); }
.status-maintenance{ background:rgba(255,107,107,0.1); color:var(--accent-red); }
.form-control{ width:100%; padding:10px; border-radius:8px; border:1px solid var(--glass); background:var(--bg-900); color:var(--text); font-family:inherit; }

/* =========================
   MODAL DIALOG
   ========================= */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); z-index:2000; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity 220ms var(--ease); }
.modal.show{ opacity:1; pointer-events:auto; }
.modal-content{ background:var(--bg-800); padding:24px; border-radius:var(--radius); width:100%; max-width:560px; box-shadow:0 20px 60px rgba(0,0,0,0.2); transform:scale(0.95); transition:transform 220ms var(--ease); }
.modal.show .modal-content{ transform:scale(1); }
.modal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
.modal-header h3{ margin:0; font-family:"Poppins"; }

/* =========================
   RESPONSIVE
   ========================= */
@media(max-width:980px){
  .dashboard-wrap{ grid-template-columns:1fr; }
  .sidebar{ position:relative; top:0; height:auto; flex-direction:row; overflow-x:auto; }
  .tab-btn{ flex-direction:column; gap:4px; font-size:12px; }
}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header container">
    <div class="brand">
      <div class="logo">SL</div>
      <div>
        <div style="font-weight:700;">Inventory Management</div>
        <div class="kv">Lab Assistant Dashboard</div>
      </div>
    </div>
    <div style="text-align:right;">
      <div style="font-weight:800">Ravi Kumar</div>
      <div class="kv">Lab Assistant</div>
    </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="container dashboard-wrap">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <button class="tab-btn" data-tab="inventory" aria-selected="true"><i class="fa-solid fa-boxes-stacked"></i> Inventory</button>
      <button class="tab-btn" data-tab="assignment"><i class="fa-solid fa-people-arrows"></i> Auto-Assign</button>
      <button class="tab-btn" data-tab="alerts"><i class="fa-solid fa-bell"></i> Low Stock Alerts</button>
      <div style="margin-top:auto"></div>
      <button class="tab-btn" data-tab="settings"><i class="fa-solid fa-cog"></i> Settings</button>
    </aside>

    <!-- CONTENT AREA -->
    <section class="content">
      <div id="tabContainer">

        <!-- Inventory -->
        <div class="tab-panel fade-in show" id="panel-inventory">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="font-family:'Poppins'; margin-top:0;">Equipment Inventory</h2>
            <button class="btn btn-primary" onclick="showEquipmentModal()"><i class="fa-solid fa-plus"></i> Add Equipment</button>
          </div>
          <div class="card">
            <table class="data-table">
              <thead><tr><th>ID</th><th>Name</th><th>Category</th><th>Status</th><th>QR Code</th><th>Actions</th></tr></thead>
              <tbody id="inventory-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Auto-Assignment -->
        <div class="tab-panel fade-in hidden" id="panel-assignment">
            <h2 style="font-family:'Poppins'; margin-top:0;">Auto-Assign Equipment</h2>
            <div class="card">
                <div style="display:flex; gap:16px; align-items:center;">
                    <div>
                        <label for="class-assign-selector" class="kv">Select Class for Assignment:</label>
                        <select id="class-assign-selector" class="form-control"></select>
                    </div>
                    <button class="btn btn-primary" onclick="runAutoAssignment()">Run Assignment</button>
                </div>
            </div>
            <div class="card" style="margin-top:16px;">
                <h3 style="margin-top:0;">Assignment Results</h3>
                <table class="data-table">
                    <thead><tr><th>Equipment ID</th><th>Equipment Name</th><th>Assigned To Student</th></tr></thead>
                    <tbody id="assignment-results-tbody"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Low Stock Alerts -->
        <div class="tab-panel fade-in hidden" id="panel-alerts">
            <h2 style="font-family:'Poppins'; margin-top:0;">Low Stock Alerts</h2>
            <div class="card">
                <table class="data-table">
                    <thead><tr><th>Item Name</th><th>Category</th><th>Current Quantity</th><th>Min. Stock</th><th>Action</th></tr></thead>
                    <tbody id="low-stock-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Settings -->
        <div class="tab-panel fade-in hidden" id="panel-settings">
          <h2 style="font-family:'Poppins'; margin-top:0;">Settings</h2>
          <div class="card">
            <button id="themeToggle" class="btn btn-ghost">Toggle Light/Dark Mode</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Equipment Modal -->
  <div id="equipmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="equipmentModalTitle">Add Equipment</h3>
            <button class="btn btn-ghost" onclick="closeModal('equipmentModal')">&times;</button>
        </div>
        <form id="equipmentForm" onsubmit="handleEquipmentSubmit(event)">
            <input type="hidden" id="edit-id">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                <div><label>Equipment ID</label><input type="text" id="equip-id" class="form-control" required></div>
                <div><label>Name</label><input type="text" id="equip-name" class="form-control" required></div>
                <div><label>Category</label><input type="text" id="equip-category" class="form-control" required></div>
                <div><label>Status</label>
                    <select id="equip-status" class="form-control">
                        <option>Available</option>
                        <option>In-Use</option>
                        <option>Maintenance</option>
                    </select>
                </div>
            </div>
            <div style="text-align:right; margin-top:20px;">
                <button type="submit" class="btn btn-primary">Save Equipment</button>
            </div>
        </form>
    </div>
  </div>

<script>
(function() {
    'use strict';
    /* =========================
       MOCK DATA
       ========================= */
    let equipment = [
        // Imaging Equipment (20+)
        ...Array.from({ length: 22 }, (_, i) => ({ id: `CAM-${String(i + 1).padStart(2, '0')}`, name: `High-Res Camera ${i + 1}`, category: 'Imaging', status: 'Available' })),
        // Computing Equipment (20+)
        ...Array.from({ length: 25 }, (_, i) => ({ id: `SVR-${String(i + 1).padStart(2, '0')}`, name: `Database Server ${i + 1}`, category: 'Computing', status: 'Available' })),
        // Robotics Equipment (20+)
        ...Array.from({ length: 20 }, (_, i) => ({ id: `RBA-${String(i + 1).padStart(2, '0')}`, name: `Robotic Arm ${i + 1}`, category: 'Robotics', status: 'Available' })),
        // Cybersecurity Equipment (20+)
        ...Array.from({ length: 20 }, (_, i) => ({ id: `FWL-${String(i + 1).padStart(2, '0')}`, name: `Firewall Appliance ${i + 1}`, category: 'Networking', status: 'Available' })),
        // Other Equipment
        { id: 'DAQ-01', name: 'Data Acquisition Card', category: 'Instrumentation', status: 'Maintenance' },
        { id: 'DAQ-02', name: 'Data Acquisition Card', category: 'Instrumentation', status: 'In-Use' },
        { id: 'OSC-001', name: 'Oscilloscope', category: 'Measurement', status: 'Available' },
        { id: 'PSU-001', name: 'Power Supply', category: 'Power', status: 'In-Use' },
        { id: '3DP-01', name: '3D Printer', category: 'Fabrication', status: 'In-Use' },
        { id: 'CNC-01', name: 'CNC Mill', category: 'Fabrication', status: 'Available' }
    ];
    
    let consumables = [
        { name: 'Resistors (1k Ohm)', category: 'Components', quantity: 85, minStock: 100 },
        { name: 'Capacitors (10uF)', category: 'Components', quantity: 150, minStock: 100 },
        { name: 'LEDs (Red)', category: 'Components', quantity: 250, minStock: 200 },
        { name: 'Jumper Wires', category: 'Cabling', quantity: 95, minStock: 100 },
        { name: 'Solder Wire', category: 'Tools', quantity: 5, minStock: 10 },
        { name: 'PLA Filament (White)', category: 'Fabrication', quantity: 1, minStock: 2 },
        { name: 'PLA Filament (Black)', category: 'Fabrication', quantity: 3, minStock: 2 },
        { name: 'Arduino Uno', category: 'Microcontrollers', quantity: 12, minStock: 10 },
        { name: 'Raspberry Pi 4', category: 'Microcontrollers', quantity: 4, minStock: 5 },
        { name: 'Ethernet Cables (1m)', category: 'Cabling', quantity: 25, minStock: 50 }
    ];

    const students = Array.from({ length: 80 }, (_, i) => ({ id: `S${String(i + 1).padStart(3, '0')}`, name: `Student ${i + 1}` }));

    const classes = [
        { id: 'C101', name: 'Image Processing Lab', studentIds: students.slice(0, 20).map(s => s.id), requiredCategory: 'Imaging' },
        { id: 'C102', name: 'DBMS Lab', studentIds: students.slice(20, 40).map(s => s.id), requiredCategory: 'Computing' },
        { id: 'C106', name: 'Cybersecurity Lab', studentIds: students.slice(40, 60).map(s => s.id), requiredCategory: 'Networking' },
        { id: 'C107', name: 'Robotics Lab', studentIds: students.slice(60, 80).map(s => s.id), requiredCategory: 'Robotics' }
    ];
    
    let assignmentResults = [];

    /* =========================
       INITIALIZATION & THEME
       ========================= */
    function init() {
        setupTheme();
        populateClassSelector();
        renderAll();
    }

    function setupTheme() {
        const themeToggle = document.getElementById('themeToggle');
        const applyTheme = (theme) => {
            document.documentElement.classList.toggle('light', theme === 'light');
        };
        applyTheme(localStorage.getItem('smartlab-theme'));
        themeToggle.addEventListener('click', () => {
            const isLight = document.documentElement.classList.toggle('light');
            localStorage.setItem('smartlab-theme', isLight ? 'light' : 'dark');
        });
    }

    /* =========================
       RENDERING FUNCTIONS
       ========================= */
    function renderAll() {
        renderInventory();
        renderLowStockAlerts();
        renderAssignmentResults();
    }

    function renderInventory() {
        const tbody = document.getElementById('inventory-tbody');
        tbody.innerHTML = '';
        equipment.forEach(item => {
            const tr = document.createElement('tr');
            const statusClass = item.status.toLowerCase().replace('-', '');
            tr.innerHTML = `
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td>${item.category}</td>
                <td><span class="status-badge status-${statusClass}">${item.status}</span></td>
                <td class="qr-cell" data-id="${item.id}"></td>
                <td>
                    <button class="btn btn-ghost" onclick="showEquipmentModal('${item.id}')"><i class="fa-solid fa-pencil"></i></button>
                    <button class="btn btn-ghost" style="color:var(--accent-red)" onclick="deleteEquipment('${item.id}')"><i class="fa-solid fa-trash"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
        });
        generateQRCodes();
    }
    
    function renderLowStockAlerts() {
        const tbody = document.getElementById('low-stock-tbody');
        tbody.innerHTML = '';
        consumables.filter(c => c.quantity < c.minStock).forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${item.name}</td>
                <td>${item.category}</td>
                <td>${item.quantity}</td>
                <td>${item.minStock}</td>
                <td><button class="btn btn-primary" onclick="alert('Creating reorder request for ${item.name}')">Reorder</button></td>
            `;
            tbody.appendChild(tr);
        });
    }
    
    function renderAssignmentResults() {
        const tbody = document.getElementById('assignment-results-tbody');
        tbody.innerHTML = '';
        if (assignmentResults.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;" class="kv">No assignments run yet.</td></tr>';
            return;
        }
        assignmentResults.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${item.equipmentId}</td><td>${item.equipmentName}</td><td>${item.studentName} (${item.studentId})</td>`;
            tbody.appendChild(tr);
        });
    }

    /* =========================
       CORE LOGIC
       ========================= */
    function populateClassSelector() {
        const selector = document.getElementById('class-assign-selector');
        classes.forEach(c => selector.add(new Option(`${c.name} (${c.studentIds.length} students)`, c.id)));
    }
    
    window.runAutoAssignment = () => {
        const classId = document.getElementById('class-assign-selector').value;
        const selectedClass = classes.find(c => c.id === classId);
        
        // Filter equipment by the required category for the class AND status 'Available'
        const availableEquip = equipment.filter(e => e.status === 'Available' && e.category === selectedClass.requiredCategory);
        
        assignmentResults = [];
        if (availableEquip.length < selectedClass.studentIds.length) {
            alert(`Error: Not enough available equipment in the "${selectedClass.requiredCategory}" category. Required: ${selectedClass.studentIds.length}, Available: ${availableEquip.length}`);
            return;
        }
        
        selectedClass.studentIds.forEach((studentId, index) => {
            const student = students.find(s => s.id === studentId);
            if(student) {
                assignmentResults.push({
                    equipmentId: availableEquip[index].id,
                    equipmentName: availableEquip[index].name,
                    studentId: student.id,
                    studentName: student.name
                });
            }
        });

        renderAssignmentResults();
        alert(`Successfully generated assignments for ${selectedClass.name}.`);
    };

    window.showEquipmentModal = (id = null) => {
        const form = document.getElementById('equipmentForm');
        form.reset();
        document.getElementById('equipmentModalTitle').textContent = id ? 'Edit Equipment' : 'Add Equipment';
        if (id) {
            const item = equipment.find(e => e.id === id);
            document.getElementById('edit-id').value = id;
            document.getElementById('equip-id').value = item.id;
            document.getElementById('equip-id').readOnly = true;
            document.getElementById('equip-name').value = item.name;
            document.getElementById('equip-category').value = item.category;
            document.getElementById('equip-status').value = item.status;
        } else {
            document.getElementById('edit-id').value = '';
            document.getElementById('equip-id').readOnly = false;
        }
        document.getElementById('equipmentModal').classList.add('show');
    };
    
    window.closeModal = (id) => document.getElementById(id).classList.remove('show');

    window.handleEquipmentSubmit = (event) => {
        event.preventDefault();
        const editId = document.getElementById('edit-id').value;
        const itemData = {
            id: document.getElementById('equip-id').value,
            name: document.getElementById('equip-name').value,
            category: document.getElementById('equip-category').value,
            status: document.getElementById('equip-status').value,
        };
        
        if (editId) {
            equipment = equipment.map(e => e.id === editId ? itemData : e);
        } else {
            equipment.push(itemData);
        }
        renderInventory();
        closeModal('equipmentModal');
    };
    
    window.deleteEquipment = (id) => {
        equipment = equipment.filter(e => e.id !== id);
        renderInventory();
        alert(`Equipment ${id} has been deleted.`);
    };
    
    function generateQRCodes() {
        document.querySelectorAll('.qr-cell').forEach(cell => {
            cell.innerHTML = '';
            new QRCode(cell, { text: cell.dataset.id, width: 40, height: 40 });
        });
    }

    /* =========================
       TAB NAVIGATION
       ========================= */
    const tabBtns = document.querySelectorAll('.tab-btn');
    tabBtns.forEach(btn => btn.addEventListener('click', () => {
        tabBtns.forEach(b => b.setAttribute('aria-selected', 'false'));
        btn.setAttribute('aria-selected', 'true');
        document.querySelectorAll('.tab-panel').forEach(p => {
            p.classList.toggle('hidden', p.id !== `panel-${btn.dataset.tab}`);
            if (p.id === `panel-${btn.dataset.tab}`) {
                setTimeout(() => p.classList.add('show'), 10);
            } else {
                p.classList.remove('show');
            }
        });
    }));

    // Initialize
    init();
})();
</script>
</body>
</html>